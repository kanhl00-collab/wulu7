{"filter":false,"title":"server.py","tooltip":"/server.py","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":99,"column":20},"end":{"row":99,"column":24},"action":"insert","lines":["    "],"id":824}],[{"start":{"row":100,"column":12},"end":{"row":100,"column":16},"action":"insert","lines":["    "],"id":825}],[{"start":{"row":100,"column":16},"end":{"row":100,"column":20},"action":"insert","lines":["    "],"id":826}],[{"start":{"row":100,"column":20},"end":{"row":100,"column":24},"action":"insert","lines":["    "],"id":827}],[{"start":{"row":102,"column":4},"end":{"row":102,"column":8},"action":"insert","lines":["    "],"id":828}],[{"start":{"row":102,"column":8},"end":{"row":102,"column":12},"action":"insert","lines":["    "],"id":829}],[{"start":{"row":102,"column":12},"end":{"row":102,"column":16},"action":"insert","lines":["    "],"id":830}],[{"start":{"row":104,"column":4},"end":{"row":104,"column":8},"action":"insert","lines":["    "],"id":831}],[{"start":{"row":104,"column":8},"end":{"row":104,"column":12},"action":"insert","lines":["    "],"id":832}],[{"start":{"row":104,"column":12},"end":{"row":104,"column":16},"action":"insert","lines":["    "],"id":833}],[{"start":{"row":105,"column":8},"end":{"row":105,"column":12},"action":"insert","lines":["    "],"id":834}],[{"start":{"row":105,"column":12},"end":{"row":105,"column":16},"action":"insert","lines":["    "],"id":835}],[{"start":{"row":105,"column":16},"end":{"row":105,"column":20},"action":"insert","lines":["    "],"id":836}],[{"start":{"row":106,"column":8},"end":{"row":106,"column":12},"action":"insert","lines":["    "],"id":837}],[{"start":{"row":106,"column":12},"end":{"row":106,"column":16},"action":"insert","lines":["    "],"id":838}],[{"start":{"row":106,"column":16},"end":{"row":106,"column":20},"action":"insert","lines":["    "],"id":839}],[{"start":{"row":107,"column":8},"end":{"row":107,"column":12},"action":"insert","lines":["    "],"id":840}],[{"start":{"row":107,"column":12},"end":{"row":107,"column":16},"action":"insert","lines":["    "],"id":841}],[{"start":{"row":107,"column":16},"end":{"row":107,"column":20},"action":"insert","lines":["    "],"id":842}],[{"start":{"row":108,"column":8},"end":{"row":108,"column":12},"action":"insert","lines":["    "],"id":843}],[{"start":{"row":108,"column":12},"end":{"row":108,"column":16},"action":"insert","lines":["    "],"id":844}],[{"start":{"row":108,"column":16},"end":{"row":108,"column":20},"action":"insert","lines":["    "],"id":845}],[{"start":{"row":109,"column":8},"end":{"row":109,"column":12},"action":"insert","lines":["    "],"id":846}],[{"start":{"row":109,"column":12},"end":{"row":109,"column":16},"action":"insert","lines":["    "],"id":847}],[{"start":{"row":109,"column":16},"end":{"row":109,"column":20},"action":"insert","lines":["    "],"id":848}],[{"start":{"row":110,"column":8},"end":{"row":110,"column":12},"action":"insert","lines":["    "],"id":849}],[{"start":{"row":110,"column":12},"end":{"row":110,"column":16},"action":"insert","lines":["    "],"id":850}],[{"start":{"row":110,"column":16},"end":{"row":110,"column":20},"action":"insert","lines":["    "],"id":851}],[{"start":{"row":111,"column":8},"end":{"row":111,"column":12},"action":"insert","lines":["    "],"id":852}],[{"start":{"row":111,"column":12},"end":{"row":111,"column":16},"action":"insert","lines":["    "],"id":853}],[{"start":{"row":111,"column":16},"end":{"row":111,"column":20},"action":"insert","lines":["    "],"id":854}],[{"start":{"row":112,"column":4},"end":{"row":112,"column":8},"action":"insert","lines":["    "],"id":855}],[{"start":{"row":112,"column":8},"end":{"row":112,"column":12},"action":"insert","lines":["    "],"id":856}],[{"start":{"row":112,"column":12},"end":{"row":112,"column":16},"action":"insert","lines":["    "],"id":857}],[{"start":{"row":113,"column":8},"end":{"row":113,"column":12},"action":"insert","lines":["    "],"id":858}],[{"start":{"row":113,"column":12},"end":{"row":113,"column":16},"action":"insert","lines":["    "],"id":859}],[{"start":{"row":113,"column":16},"end":{"row":113,"column":20},"action":"insert","lines":["    "],"id":860}],[{"start":{"row":102,"column":68},"end":{"row":103,"column":0},"action":"insert","lines":["",""],"id":861},{"start":{"row":103,"column":0},"end":{"row":103,"column":16},"action":"insert","lines":["                "]},{"start":{"row":103,"column":16},"end":{"row":103,"column":17},"action":"insert","lines":["p"]}],[{"start":{"row":103,"column":17},"end":{"row":103,"column":18},"action":"insert","lines":["r"],"id":862},{"start":{"row":103,"column":18},"end":{"row":103,"column":19},"action":"insert","lines":["i"]},{"start":{"row":103,"column":19},"end":{"row":103,"column":20},"action":"insert","lines":["n"]},{"start":{"row":103,"column":20},"end":{"row":103,"column":21},"action":"insert","lines":["t"]}],[{"start":{"row":103,"column":21},"end":{"row":103,"column":23},"action":"insert","lines":["()"],"id":863}],[{"start":{"row":103,"column":22},"end":{"row":103,"column":23},"action":"insert","lines":["p"],"id":864},{"start":{"row":103,"column":23},"end":{"row":103,"column":24},"action":"insert","lines":["y"]},{"start":{"row":103,"column":24},"end":{"row":103,"column":25},"action":"insert","lines":["t"]}],[{"start":{"row":103,"column":22},"end":{"row":103,"column":25},"action":"remove","lines":["pyt"],"id":865},{"start":{"row":103,"column":22},"end":{"row":103,"column":34},"action":"insert","lines":["python_lines"]}],[{"start":{"row":49,"column":24},"end":{"row":49,"column":67},"action":"remove","lines":["escaped = line.rstrip().replace('\"', '\\\\\"')"],"id":866},{"start":{"row":49,"column":24},"end":{"row":49,"column":89},"action":"insert","lines":["escaped = line.rstrip().replace(\"\\\\\", \"\\\\\\\\\").replace('\"', '\\\\\"')"]}],[{"start":{"row":8,"column":0},"end":{"row":128,"column":2},"action":"remove","lines":["class WebServer:","    def __init__(self, root_dir, port):","        self.root_dir = root_dir","        self.port = port","","    def __enter__(self):","        os.chdir(self.root_dir)","","        class Handler(http.server.SimpleHTTPRequestHandler):","            def do_GET(self):","                parsed = urllib.parse.urlparse(self.path)","                path = parsed.path[1:] or \"index.html\"","                query = urllib.parse.parse_qs(parsed.query)","","                if path == \"hello\":","                    self.render_template(\"hello.html\", {\"message\": query.get(\"message\", [\"\"])[0]})","                else:","                    super().do_GET()","","            def do_POST(self):","                if self.path == \"/whatsup\":","                    length = int(self.headers.get(\"Content-Length\"))","                    body = self.rfile.read(length).decode()","                    post_data = urllib.parse.parse_qs(body)","                    info = post_data.get(\"info\", [\"\"])[0]","                    self.render_template(\"whatsup.html\", {\"info\": info})","                else:","                    self.send_error(404)","","            def render_template(self, filename, context):","                with open(filename, 'r') as f:","                    lines = f.readlines()","","                in_code_block = False","                python_lines = []","                indent_level = 0","","                def add_line(line, is_code=True):","                    if is_code:","                        python_lines.append(\" \" * indent_level + line)","                    else:","                        escaped = line.rstrip().replace(\"\\\\\", \"\\\\\\\\\").replace('\"', '\\\\\"')","                        python_lines.append(\" \" * indent_level + f'__result.append(\"{escaped}\")')","","                python_lines.append(\"__result = []\")","","                for line in lines:","                    stripped = line.strip()","","                    # Inline expression, like <%= info %>","                    if \"<%=\" in line and \"%>\" in line:","                        start = line.find(\"<%=\")","                        end = line.find(\"%>\", start)","                        expr = line[start + 3:end].strip()","                        before = line[:start]","                        after = line[end + 2:]","                        add_line(f'__result.append(f\"\"\"{before}{{str({expr})}}{after}\"\"\")', is_code=True)","","                    elif \"<%\" in line and not \"%>\" in line:","                        # Start of multi-line code block","                        in_code_block = True","                        code = line[line.find(\"<%\") + 2:].rstrip()","                        if code:","                            add_line(code)","                            if code.endswith(\":\"):","                                indent_level += 4","","                    elif \"%>\" in line and in_code_block:","                        # End of multi-line code block","                        code = line[:line.find(\"%>\")].rstrip()","                        if code:","                            add_line(code)","                            if not code.endswith(\":\"):","                                indent_level = max(indent_level - 4, 0)","                        in_code_block = False","","                    elif in_code_block:","                        # Middle of Python block","                        code = line.rstrip()","                        add_line(code)","                        if code.endswith(\":\"):","                            indent_level += 4","","                    elif stripped.startswith(\"<%\") and stripped.endswith(\"%>\"):","                        # One-line control like <% if info == \"\": %>","                        code = stripped[2:-2].strip()","                        add_line(code)","                        if code.endswith(\":\"):","                            indent_level += 4","","                    else:","                        # HTML line","                        add_line(line, is_code=False)","","                python_lines.append(\"result = '\\\\n'.join(__result)\")","                print(python_lines)","","                try:","                    local_vars = context.copy()","                    exec(\"\\n\".join(python_lines), {}, local_vars)","                    result = local_vars[\"result\"]","                    self.send_response(200)","                    self.send_header(\"Content-type\", \"text/html\")","                    self.end_headers()","                    self.wfile.write(result.encode())","                except Exception as e:","                    self.send_error(500, f\"Template error: {e}\")","","","","","        self.httpd = socketserver.TCPServer((\"\", self.port), Handler)","        return self","","    def start(self):","        print(f\"Serving on port {self.port}\")","        self.httpd.serve_forever()","","    def __exit__(self, exc_type, exc_val, exc_tb):","        self.httpd.server_close()","  "],"id":867}],[{"start":{"row":8,"column":0},"end":{"row":24,"column":35},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            raw = f.read()","","        # Replace <%= var %>","        raw = raw.replace('<%= ', '{{ ').replace(' %>', ' }}')","        raw = raw.replace('<%', '{% ').replace('%>', ' %}')","","        # Prepare Python-renderable template","        code = 'from jinja2 import Template\\n'","        code += f\"tpl = Template('''{raw}''')\\n\"","        code += 'output = tpl.render(**context)\\n'","","        local_vars = {}","        exec(code, {}, local_vars)","        return local_vars['output']"],"id":868}],[{"start":{"row":27,"column":2},"end":{"row":27,"column":3},"action":"remove","lines":["'"],"id":869},{"start":{"row":27,"column":1},"end":{"row":27,"column":2},"action":"remove","lines":["'"]},{"start":{"row":27,"column":0},"end":{"row":27,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":78,"column":2},"end":{"row":78,"column":3},"action":"remove","lines":["'"],"id":870},{"start":{"row":78,"column":1},"end":{"row":78,"column":2},"action":"remove","lines":["'"]},{"start":{"row":78,"column":0},"end":{"row":78,"column":1},"action":"remove","lines":["'"]}],[{"start":{"row":8,"column":0},"end":{"row":24,"column":35},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            raw = f.read()","","        # Replace <%= var %>","        raw = raw.replace('<%= ', '{{ ').replace(' %>', ' }}')","        raw = raw.replace('<%', '{% ').replace('%>', ' %}')","","        # Prepare Python-renderable template","        code = 'from jinja2 import Template\\n'","        code += f\"tpl = Template('''{raw}''')\\n\"","        code += 'output = tpl.render(**context)\\n'","","        local_vars = {}","        exec(code, {}, local_vars)","        return local_vars['output']"],"id":871},{"start":{"row":8,"column":0},"end":{"row":21,"column":36},"action":"insert","lines":["from jinja2 import Template","","class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            raw = f.read()","","        # Convert custom tags to Jinja2-compatible ones","        raw = raw.replace('<%= ', '{{ ').replace(' %>', ' }}')","        raw = raw.replace('<%', '{% ').replace('%>', ' %}')","","        # Render with Jinja2","        tpl = Template(raw)","        return tpl.render(**context)"]}],[{"start":{"row":3,"column":0},"end":{"row":6,"column":9},"action":"remove","lines":["import http.server","import socketserver","import urllib.parse","import os"],"id":872},{"start":{"row":2,"column":10},"end":{"row":3,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":2,"column":10},"end":{"row":3,"column":0},"action":"remove","lines":["",""],"id":873}],[{"start":{"row":5,"column":0},"end":{"row":16,"column":36},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            raw = f.read()","","        # Convert custom tags to Jinja2-compatible ones","        raw = raw.replace('<%= ', '{{ ').replace(' %>', ' }}')","        raw = raw.replace('<%', '{% ').replace('%>', ' %}')","","        # Render with Jinja2","        tpl = Template(raw)","        return tpl.render(**context)"],"id":874},{"start":{"row":5,"column":0},"end":{"row":40,"column":35},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = [\"output = []\"]","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                code.append(f\"output.append({repr(src[pos:])})\")","                break","","            # Static HTML before tag","            code.append(f\"output.append({repr(src[pos:start])})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %> tag\")","                expr = src[start + 3:end].strip()","                code.append(f\"output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %> tag\")","                stmt = src[start + 2:end].strip()","                code.append(stmt)","                pos = end + 2","","        code.append(\"result = ''.join(output)\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), {}, local_vars)","        return local_vars[\"result\"]"]}],[{"start":{"row":5,"column":0},"end":{"row":40,"column":35},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = [\"output = []\"]","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                code.append(f\"output.append({repr(src[pos:])})\")","                break","","            # Static HTML before tag","            code.append(f\"output.append({repr(src[pos:start])})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %> tag\")","                expr = src[start + 3:end].strip()","                code.append(f\"output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %> tag\")","                stmt = src[start + 2:end].strip()","                code.append(stmt)","                pos = end + 2","","        code.append(\"result = ''.join(output)\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), {}, local_vars)","        return local_vars[\"result\"]"],"id":875},{"start":{"row":5,"column":0},"end":{"row":42,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = [\"def __render_func__():\", \"    output = []\"]","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                code.append(f\"    output.append({repr(src[pos:])})\")","                break","","            code.append(f\"    output.append({repr(src[pos:start])})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                code.append(f\"    output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                # add raw statement without output.append","                code.append(f\"    {stmt}\")","                pos = end + 2","","        code.append(\"    return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), {}, local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":40,"column":32},"end":{"row":40,"column":33},"action":"remove","lines":[","],"id":876},{"start":{"row":40,"column":31},"end":{"row":40,"column":32},"action":"remove","lines":["}"]},{"start":{"row":40,"column":30},"end":{"row":40,"column":31},"action":"remove","lines":["{"]},{"start":{"row":40,"column":29},"end":{"row":40,"column":30},"action":"remove","lines":[" "]}],[{"start":{"row":5,"column":0},"end":{"row":41,"column":35},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = [\"def __render_func__():\", \"    output = []\"]","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                code.append(f\"    output.append({repr(src[pos:])})\")","                break","","            code.append(f\"    output.append({repr(src[pos:start])})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                code.append(f\"    output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                # add raw statement without output.append","                code.append(f\"    {stmt}\")","                pos = end + 2","","        code.append(\"    return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]"],"id":877},{"start":{"row":5,"column":0},"end":{"row":50,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        code.append(\"def __render_func__():\")","        indent = \"    \"  # 4 spaces","        code.append(f\"{indent}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                html = src[pos:]","                if html:","                    code.append(f\"{indent}output.append({repr(html)})\")","                break","","            # Static HTML before code tag","            html = src[pos:start]","            if html:","                code.append(f\"{indent}output.append({repr(html)})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                code.append(f\"{indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                code.append(f\"{indent}{stmt}\")","                pos = end + 2","","        code.append(f\"{indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":45,"column":49},"end":{"row":46,"column":0},"action":"insert","lines":["",""],"id":878},{"start":{"row":46,"column":0},"end":{"row":46,"column":8},"action":"insert","lines":["        "]},{"start":{"row":46,"column":8},"end":{"row":46,"column":9},"action":"insert","lines":["p"]},{"start":{"row":46,"column":9},"end":{"row":46,"column":10},"action":"insert","lines":["r"]},{"start":{"row":46,"column":10},"end":{"row":46,"column":11},"action":"insert","lines":["i"]},{"start":{"row":46,"column":11},"end":{"row":46,"column":12},"action":"insert","lines":["n"]}],[{"start":{"row":46,"column":12},"end":{"row":46,"column":13},"action":"insert","lines":["t"],"id":879}],[{"start":{"row":46,"column":13},"end":{"row":46,"column":15},"action":"insert","lines":["()"],"id":880}],[{"start":{"row":46,"column":14},"end":{"row":46,"column":15},"action":"insert","lines":["c"],"id":881},{"start":{"row":46,"column":15},"end":{"row":46,"column":16},"action":"insert","lines":["o"]},{"start":{"row":46,"column":16},"end":{"row":46,"column":17},"action":"insert","lines":["d"]},{"start":{"row":46,"column":17},"end":{"row":46,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":27,"column":38},"end":{"row":27,"column":39},"action":"insert","lines":[" "],"id":882}],[{"start":{"row":27,"column":38},"end":{"row":27,"column":39},"action":"remove","lines":[" "],"id":883},{"start":{"row":27,"column":38},"end":{"row":27,"column":40},"action":"insert","lines":[". "]}],[{"start":{"row":27,"column":40},"end":{"row":27,"column":41},"action":"insert","lines":[" "],"id":884},{"start":{"row":27,"column":41},"end":{"row":27,"column":42},"action":"insert","lines":[" "]}],[{"start":{"row":27,"column":41},"end":{"row":27,"column":42},"action":"remove","lines":[" "],"id":885},{"start":{"row":27,"column":40},"end":{"row":27,"column":41},"action":"remove","lines":[" "]},{"start":{"row":27,"column":39},"end":{"row":27,"column":40},"action":"remove","lines":[" "]},{"start":{"row":27,"column":38},"end":{"row":27,"column":39},"action":"remove","lines":["."]}],[{"start":{"row":27,"column":38},"end":{"row":27,"column":39},"action":"insert","lines":[" "],"id":886},{"start":{"row":27,"column":39},"end":{"row":27,"column":40},"action":"insert","lines":[" "]},{"start":{"row":27,"column":40},"end":{"row":27,"column":41},"action":"insert","lines":[" "]},{"start":{"row":27,"column":41},"end":{"row":27,"column":42},"action":"insert","lines":[" "]}],[{"start":{"row":5,"column":0},"end":{"row":52,"column":0},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        code.append(\"def __render_func__():\")","        indent = \"    \"  # 4 spaces","        code.append(f\"{indent}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                html = src[pos:]","                if html:","                    code.append(f\"{indent}output.append({repr(html)})\")","                break","","            # Static HTML before code tag","            html = src[pos:start]","            if html:","                code.append(f\"{indent}    output.append({repr(html)})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                code.append(f\"{indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                code.append(f\"{indent}{stmt}\")","                pos = end + 2","","        code.append(f\"{indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","        print(code)","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]","",""],"id":887},{"start":{"row":5,"column":0},"end":{"row":42,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = [\"def __render_func__():\", \"    output = []\"]","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                code.append(f\"    output.append({repr(src[pos:])})\")","                break","","            code.append(f\"    output.append({repr(src[pos:start])})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                code.append(f\"    output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                code.append(f\"    {stmt}\")","                pos = end + 2","","        code.append(\"    return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        # ðŸ”¥ FIX HERE: pass context as globals to exec","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":5,"column":0},"end":{"row":42,"column":0},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = [\"def __render_func__():\", \"    output = []\"]","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                code.append(f\"    output.append({repr(src[pos:])})\")","                break","","            code.append(f\"    output.append({repr(src[pos:start])})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                code.append(f\"    output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                code.append(f\"    {stmt}\")","                pos = end + 2","","        code.append(\"    return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        # ðŸ”¥ FIX HERE: pass context as globals to exec","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""],"id":888},{"start":{"row":5,"column":0},"end":{"row":51,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        INDENT = \"    \"  # 4 spaces","        code.append(\"def __render_func__():\")","        code.append(f\"{INDENT}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                html = src[pos:]","                if html:","                    code.append(f\"{INDENT}output.append({repr(html)})\")","                break","","            html = src[pos:start]","            if html:","                code.append(f\"{INDENT}output.append({repr(html)})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                code.append(f\"{INDENT}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                # ensure indentation is added to all statements","                for line in stmt.splitlines():","                    code.append(f\"{INDENT}{line}\")","                pos = end + 2","","        code.append(f\"{INDENT}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":46,"column":49},"end":{"row":47,"column":0},"action":"insert","lines":["",""],"id":889},{"start":{"row":47,"column":0},"end":{"row":47,"column":8},"action":"insert","lines":["        "]},{"start":{"row":47,"column":8},"end":{"row":48,"column":0},"action":"insert","lines":["",""]},{"start":{"row":48,"column":0},"end":{"row":48,"column":8},"action":"insert","lines":["        "]},{"start":{"row":48,"column":8},"end":{"row":48,"column":9},"action":"insert","lines":["p"]},{"start":{"row":48,"column":9},"end":{"row":48,"column":10},"action":"insert","lines":["r"]},{"start":{"row":48,"column":10},"end":{"row":48,"column":11},"action":"insert","lines":["i"]},{"start":{"row":48,"column":11},"end":{"row":48,"column":12},"action":"insert","lines":["n"]}],[{"start":{"row":48,"column":12},"end":{"row":48,"column":13},"action":"insert","lines":["t"],"id":890}],[{"start":{"row":48,"column":13},"end":{"row":48,"column":14},"action":"insert","lines":[" "],"id":891},{"start":{"row":48,"column":14},"end":{"row":48,"column":15},"action":"insert","lines":["c"]},{"start":{"row":48,"column":15},"end":{"row":48,"column":16},"action":"insert","lines":["o"]},{"start":{"row":48,"column":16},"end":{"row":48,"column":17},"action":"insert","lines":["d"]},{"start":{"row":48,"column":17},"end":{"row":48,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":48,"column":13},"end":{"row":48,"column":14},"action":"remove","lines":[" "],"id":892}],[{"start":{"row":48,"column":13},"end":{"row":48,"column":14},"action":"insert","lines":["("],"id":893}],[{"start":{"row":48,"column":18},"end":{"row":48,"column":19},"action":"insert","lines":[")"],"id":894}],[{"start":{"row":5,"column":0},"end":{"row":53,"column":0},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        INDENT = \"    \"  # 4 spaces","        code.append(\"def __render_func__():\")","        code.append(f\"{INDENT}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                html = src[pos:]","                if html:","                    code.append(f\"{INDENT}output.append({repr(html)})\")","                break","","            html = src[pos:start]","            if html:","                code.append(f\"{INDENT}output.append({repr(html)})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                code.append(f\"{INDENT}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                # ensure indentation is added to all statements","                for line in stmt.splitlines():","                    code.append(f\"{INDENT}{line}\")","                pos = end + 2","","        code.append(f\"{INDENT}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","        ","        print(code)","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""],"id":895},{"start":{"row":5,"column":0},"end":{"row":59,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"","        indent_stack = [base_indent]  # Tracks current indentation level","","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):  # keep newlines","                        code.append(f\"{indent_stack[-1]}output.append({repr(line)})\")","                break","","            # Output HTML before <% ... %>","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    code.append(f\"{indent_stack[-1]}output.append({repr(line)})\")","","            # Process tag","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{indent_stack[-1]}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","                code.append(f\"{indent_stack[-1]}{stmt}\")","","                # Increase indent if line ends with :","                if stmt.endswith(\":\"):","                    indent_stack.append(indent_stack[-1] + \"   \")","                elif stmt == \"endif\" or stmt == \"endfor\":  # Optional: handle custom tags","                    if len(indent_stack) > 1:","                        indent_stack.pop()","","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":54,"column":49},"end":{"row":55,"column":0},"action":"insert","lines":["",""],"id":896},{"start":{"row":55,"column":0},"end":{"row":55,"column":8},"action":"insert","lines":["        "]},{"start":{"row":55,"column":8},"end":{"row":55,"column":9},"action":"insert","lines":["p"]},{"start":{"row":55,"column":9},"end":{"row":55,"column":10},"action":"insert","lines":["r"]},{"start":{"row":55,"column":10},"end":{"row":55,"column":11},"action":"insert","lines":["i"]},{"start":{"row":55,"column":11},"end":{"row":55,"column":12},"action":"insert","lines":["n"]},{"start":{"row":55,"column":12},"end":{"row":55,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":55,"column":13},"end":{"row":55,"column":15},"action":"insert","lines":["()"],"id":897}],[{"start":{"row":55,"column":14},"end":{"row":55,"column":15},"action":"insert","lines":["c"],"id":898},{"start":{"row":55,"column":15},"end":{"row":55,"column":16},"action":"insert","lines":["o"]},{"start":{"row":55,"column":16},"end":{"row":55,"column":17},"action":"insert","lines":["d"]},{"start":{"row":55,"column":17},"end":{"row":55,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":5,"column":0},"end":{"row":60,"column":0},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"","        indent_stack = [base_indent]  # Tracks current indentation level","","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):  # keep newlines","                        code.append(f\"{indent_stack[-1]}output.append({repr(line)})\")","                break","","            # Output HTML before <% ... %>","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    code.append(f\"{indent_stack[-1]}output.append({repr(line)})\")","","            # Process tag","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{indent_stack[-1]}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","                code.append(f\"{indent_stack[-1]}{stmt}\")","","                # Increase indent if line ends with :","                if stmt.endswith(\":\"):","                    indent_stack.append(indent_stack[-1] + \"   \")","                elif stmt == \"endif\" or stmt == \"endfor\":  # Optional: handle custom tags","                    if len(indent_stack) > 1:","                        indent_stack.pop()","","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","        print(code)","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""],"id":899},{"start":{"row":5,"column":0},"end":{"row":62,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"","        indent_stack = [base_indent]","        html_indent = \"\"  # Extra HTML indent applied only after control blocks","","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            # If no more tags, flush remaining HTML","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        code.append(f\"{indent_stack[-1]}output.append({repr(html_indent + line)})\")","                break","","            # Handle HTML between tags","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    code.append(f\"{indent_stack[-1]}output.append({repr(html_indent + line)})\")","","            # Process code tag","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{indent_stack[-1]}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","                code.append(f\"{indent_stack[-1]}{stmt}\")","","                # Adjust indentation level","                if stmt.endswith(\":\"):","                    indent_stack.append(indent_stack[-1] + \"    \")","                    html_indent = \"    \"  # One level deeper for HTML","                else:","                    html_indent = \"\"  # Reset HTML indentation","","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":57,"column":49},"end":{"row":58,"column":0},"action":"insert","lines":["",""],"id":900},{"start":{"row":58,"column":0},"end":{"row":58,"column":8},"action":"insert","lines":["        "]},{"start":{"row":58,"column":8},"end":{"row":58,"column":9},"action":"insert","lines":["p"]},{"start":{"row":58,"column":9},"end":{"row":58,"column":10},"action":"insert","lines":["r"]},{"start":{"row":58,"column":10},"end":{"row":58,"column":11},"action":"insert","lines":["i"]},{"start":{"row":58,"column":11},"end":{"row":58,"column":12},"action":"insert","lines":["n"]},{"start":{"row":58,"column":12},"end":{"row":58,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":58,"column":13},"end":{"row":58,"column":15},"action":"insert","lines":["()"],"id":901}],[{"start":{"row":58,"column":14},"end":{"row":58,"column":15},"action":"insert","lines":["c"],"id":902},{"start":{"row":58,"column":15},"end":{"row":58,"column":16},"action":"insert","lines":["o"]},{"start":{"row":58,"column":16},"end":{"row":58,"column":17},"action":"insert","lines":["d"]},{"start":{"row":58,"column":17},"end":{"row":58,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":5,"column":0},"end":{"row":63,"column":0},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"","        indent_stack = [base_indent]","        html_indent = \"\"  # Extra HTML indent applied only after control blocks","","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            # If no more tags, flush remaining HTML","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        code.append(f\"{indent_stack[-1]}output.append({repr(html_indent + line)})\")","                break","","            # Handle HTML between tags","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    code.append(f\"{indent_stack[-1]}output.append({repr(html_indent + line)})\")","","            # Process code tag","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{indent_stack[-1]}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","                code.append(f\"{indent_stack[-1]}{stmt}\")","","                # Adjust indentation level","                if stmt.endswith(\":\"):","                    indent_stack.append(indent_stack[-1] + \"    \")","                    html_indent = \"    \"  # One level deeper for HTML","                else:","                    html_indent = \"\"  # Reset HTML indentation","","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","        print(code)","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""],"id":903},{"start":{"row":5,"column":0},"end":{"row":56,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"  # 4 spaces inside def","        html_indent = \"\"      # Extra indent for HTML lines only","","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        code.append(f\"{base_indent}output.append({repr(html_indent + line)})\")","                break","","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    code.append(f\"{base_indent}output.append({repr(html_indent + line)})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{base_indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","                code.append(f\"{base_indent[:-4]}{stmt}\")  # Not indented past function level","","                if stmt.endswith(\":\"):","                    html_indent = \"    \"","                else:","                    html_indent = \"\"","","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":51,"column":49},"end":{"row":52,"column":0},"action":"insert","lines":["",""],"id":904},{"start":{"row":52,"column":0},"end":{"row":52,"column":8},"action":"insert","lines":["        "]},{"start":{"row":52,"column":8},"end":{"row":52,"column":9},"action":"insert","lines":["p"]},{"start":{"row":52,"column":9},"end":{"row":52,"column":10},"action":"insert","lines":["r"]},{"start":{"row":52,"column":10},"end":{"row":52,"column":11},"action":"insert","lines":["i"]},{"start":{"row":52,"column":11},"end":{"row":52,"column":12},"action":"insert","lines":["n"]},{"start":{"row":52,"column":12},"end":{"row":52,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":52,"column":13},"end":{"row":52,"column":15},"action":"insert","lines":["()"],"id":905}],[{"start":{"row":52,"column":14},"end":{"row":52,"column":15},"action":"insert","lines":["c"],"id":906},{"start":{"row":52,"column":15},"end":{"row":52,"column":16},"action":"insert","lines":["o"]},{"start":{"row":52,"column":16},"end":{"row":52,"column":17},"action":"insert","lines":["d"]},{"start":{"row":52,"column":17},"end":{"row":52,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":5,"column":0},"end":{"row":56,"column":35},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"  # 4 spaces inside def","        html_indent = \"\"      # Extra indent for HTML lines only","","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        code.append(f\"{base_indent}output.append({repr(html_indent + line)})\")","                break","","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    code.append(f\"{base_indent}output.append({repr(html_indent + line)})\")","","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{base_indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","                code.append(f\"{base_indent[:-4]}{stmt}\")  # Not indented past function level","","                if stmt.endswith(\":\"):","                    html_indent = \"    \"","                else:","                    html_indent = \"\"","","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","        print(code)","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]"],"id":907},{"start":{"row":5,"column":0},"end":{"row":54,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"  # used for output.append and return","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        html_indent = \"\"  # controls indent of HTML output only","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        code.append(f\"{base_indent}output.append({repr(html_indent + line)})\")","                break","","            # HTML before <% ... %>","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    code.append(f\"{base_indent}output.append({repr(html_indent + line)})\")","","            # handle <% ... %> or <%= ... %>","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{base_indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","","                # ðŸ”¥ Do NOT indent control flow code beyond base","                code.append(f\"{base_indent}{stmt}\")","","                # Optional: adjust how HTML is indented","                html_indent = \"    \" if stmt.endswith(\":\") else \"\"","","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()_",""]}],[{"start":{"row":54,"column":0},"end":{"row":54,"column":4},"action":"insert","lines":["    "],"id":908}],[{"start":{"row":54,"column":4},"end":{"row":54,"column":8},"action":"insert","lines":["    "],"id":909}],[{"start":{"row":54,"column":8},"end":{"row":54,"column":9},"action":"insert","lines":["p"],"id":910},{"start":{"row":54,"column":9},"end":{"row":54,"column":10},"action":"insert","lines":["r"]},{"start":{"row":54,"column":10},"end":{"row":54,"column":11},"action":"insert","lines":["i"]},{"start":{"row":54,"column":11},"end":{"row":54,"column":12},"action":"insert","lines":["n"]},{"start":{"row":54,"column":12},"end":{"row":54,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":54,"column":13},"end":{"row":54,"column":15},"action":"insert","lines":["()"],"id":911}],[{"start":{"row":54,"column":14},"end":{"row":54,"column":15},"action":"insert","lines":["c"],"id":912},{"start":{"row":54,"column":15},"end":{"row":54,"column":16},"action":"insert","lines":["o"]},{"start":{"row":54,"column":16},"end":{"row":54,"column":17},"action":"insert","lines":["d"]},{"start":{"row":54,"column":17},"end":{"row":54,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":54,"column":19},"end":{"row":55,"column":0},"action":"insert","lines":["",""],"id":913},{"start":{"row":55,"column":0},"end":{"row":55,"column":8},"action":"insert","lines":["        "]},{"start":{"row":55,"column":8},"end":{"row":56,"column":0},"action":"insert","lines":["",""]},{"start":{"row":56,"column":0},"end":{"row":56,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":56,"column":8},"end":{"row":58,"column":35},"action":"insert","lines":["local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]"],"id":914}],[{"start":{"row":53,"column":8},"end":{"row":53,"column":48},"action":"remove","lines":["code.append(\"result = __render_func__()_"],"id":915},{"start":{"row":53,"column":8},"end":{"row":53,"column":49},"action":"insert","lines":["code.append(\"result = __render_func__()\")"]}],[{"start":{"row":5,"column":0},"end":{"row":60,"column":0},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"  # used for output.append and return","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        html_indent = \"\"  # controls indent of HTML output only","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        code.append(f\"{base_indent}output.append({repr(html_indent + line)})\")","                break","","            # HTML before <% ... %>","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    code.append(f\"{base_indent}output.append({repr(html_indent + line)})\")","","            # handle <% ... %> or <%= ... %>","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{base_indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","","                # ðŸ”¥ Do NOT indent control flow code beyond base","                code.append(f\"{base_indent}{stmt}\")","","                # Optional: adjust how HTML is indented","                html_indent = \"    \" if stmt.endswith(\":\") else \"\"","","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","        print(code)","        ","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]","",""],"id":916},{"start":{"row":5,"column":0},"end":{"row":61,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        html_indent = \"\"  # Controls extra indent for HTML only","        add_html_indent = False  # Flag to apply extra HTML indent between blocks","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            # Handle HTML after last code block","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        indent = base_indent + (\"    \" if add_html_indent else \"\")","                        code.append(f\"{indent}output.append({repr(line)})\")","                break","","            # HTML before this tag","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    indent = base_indent + (\"    \" if add_html_indent else \"\")","                    code.append(f\"{indent}output.append({repr(line)})\")","","            # Handle tag","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{base_indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","","                # Write Python logic with normal indentation","                code.append(f\"{base_indent}{stmt}\")","","                # If control block (like \"if ...:\"), enable extra HTML indent","                add_html_indent = stmt.endswith(\":\")","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":56,"column":49},"end":{"row":57,"column":0},"action":"insert","lines":["",""],"id":917},{"start":{"row":57,"column":0},"end":{"row":57,"column":8},"action":"insert","lines":["        "]},{"start":{"row":57,"column":8},"end":{"row":57,"column":9},"action":"insert","lines":["p"]},{"start":{"row":57,"column":9},"end":{"row":57,"column":10},"action":"insert","lines":["r"]},{"start":{"row":57,"column":10},"end":{"row":57,"column":11},"action":"insert","lines":["i"]},{"start":{"row":57,"column":11},"end":{"row":57,"column":12},"action":"insert","lines":["n"]},{"start":{"row":57,"column":12},"end":{"row":57,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":57,"column":13},"end":{"row":57,"column":15},"action":"insert","lines":["()"],"id":918}],[{"start":{"row":57,"column":14},"end":{"row":57,"column":15},"action":"insert","lines":["c"],"id":919},{"start":{"row":57,"column":15},"end":{"row":57,"column":16},"action":"insert","lines":["o"]},{"start":{"row":57,"column":16},"end":{"row":57,"column":17},"action":"insert","lines":["d"]},{"start":{"row":57,"column":17},"end":{"row":57,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":5,"column":0},"end":{"row":63,"column":0},"action":"remove","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        html_indent = \"\"  # Controls extra indent for HTML only","        add_html_indent = False  # Flag to apply extra HTML indent between blocks","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            # Handle HTML after last code block","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        indent = base_indent + (\"    \" if add_html_indent else \"\")","                        code.append(f\"{indent}output.append({repr(line)})\")","                break","","            # HTML before this tag","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    indent = base_indent + (\"    \" if add_html_indent else \"\")","                    code.append(f\"{indent}output.append({repr(line)})\")","","            # Handle tag","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                expr = src[start + 3:end].strip()","                code.append(f\"{base_indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                stmt = src[start + 2:end].strip()","","                # Write Python logic with normal indentation","                code.append(f\"{base_indent}{stmt}\")","","                # If control block (like \"if ...:\"), enable extra HTML indent","                add_html_indent = stmt.endswith(\":\")","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","        print(code)","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]","",""],"id":920},{"start":{"row":5,"column":0},"end":{"row":63,"column":0},"action":"insert","lines":["class TemplateEngine:","    def render(self, template_path, context):","        with open(template_path, 'r') as f:","            src = f.read()","","        pos = 0","        code = []","        base_indent = \"    \"","        code.append(\"def __render_func__():\")","        code.append(f\"{base_indent}output = []\")","","        add_html_indent = False  # Tracks whether we're between a `:` and next `<%`","","        while pos < len(src):","            start = src.find(\"<%\", pos)","","            # Flush remaining HTML","            if start == -1:","                html = src[pos:]","                if html:","                    for line in html.splitlines(True):","                        indent = base_indent + (\"    \" if add_html_indent else \"\")","                        code.append(f\"{indent}output.append({repr(line)})\")","                break","","            # Emit HTML before this tag","            html = src[pos:start]","            if html:","                for line in html.splitlines(True):","                    indent = base_indent + (\"    \" if add_html_indent else \"\")","                    code.append(f\"{indent}output.append({repr(line)})\")","","            # Process the tag","            if src.startswith(\"<%=\", start):","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <%= ... %>\")","                expr = src[start + 3:end].strip()","                indent = base_indent + (\"    \" if add_html_indent else \"\")","                code.append(f\"{indent}output.append(str({expr}))\")","                pos = end + 2","            else:","                end = src.find(\"%>\", start)","                if end == -1:","                    raise SyntaxError(\"Unclosed <% ... %>\")","                stmt = src[start + 2:end].strip()","                code.append(f\"{base_indent}{stmt}\")","","                # Activate HTML indent if this is a block (ends with :)","                add_html_indent = stmt.endswith(\":\")","                pos = end + 2","","        code.append(f\"{base_indent}return ''.join(output)\")","        code.append(\"result = __render_func__()\")","","        local_vars = dict(context)","        exec(\"\\n\".join(code), local_vars)","        return local_vars[\"result\"]",""]}],[{"start":{"row":58,"column":49},"end":{"row":59,"column":0},"action":"insert","lines":["",""],"id":921},{"start":{"row":59,"column":0},"end":{"row":59,"column":8},"action":"insert","lines":["        "]},{"start":{"row":59,"column":8},"end":{"row":59,"column":9},"action":"insert","lines":["p"]},{"start":{"row":59,"column":9},"end":{"row":59,"column":10},"action":"insert","lines":["r"]},{"start":{"row":59,"column":10},"end":{"row":59,"column":11},"action":"insert","lines":["i"]},{"start":{"row":59,"column":11},"end":{"row":59,"column":12},"action":"insert","lines":["n"]},{"start":{"row":59,"column":12},"end":{"row":59,"column":13},"action":"insert","lines":["t"]}],[{"start":{"row":59,"column":13},"end":{"row":59,"column":15},"action":"insert","lines":["()"],"id":922}],[{"start":{"row":59,"column":14},"end":{"row":59,"column":15},"action":"insert","lines":["c"],"id":923},{"start":{"row":59,"column":15},"end":{"row":59,"column":16},"action":"insert","lines":["o"]},{"start":{"row":59,"column":16},"end":{"row":59,"column":17},"action":"insert","lines":["d"]},{"start":{"row":59,"column":17},"end":{"row":59,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":59,"column":8},"end":{"row":59,"column":9},"action":"insert","lines":["#"],"id":925}]]},"ace":{"folds":[],"scrolltop":770,"scrollleft":0,"selection":{"start":{"row":59,"column":9},"end":{"row":59,"column":9},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":47,"state":"start","mode":"ace/mode/python"}},"timestamp":1748237649566,"hash":"2a2327b0387324ca673c181986c2ebed34b8386a"}